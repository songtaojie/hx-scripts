version: '3.7'

services:
  hx.blog.api:
    container_name: hx.blog.api
    image: registry.cn-hangzhou.aliyuncs.com/songtaojie_centos/hx.blog.api
    build:
      context: /home/songtaojie/git/blog-server
      dockerfile: src/HxCore.Web/Dockerfile
    environment:
      - ConnectionStrings__MySqlConnectionString=Server=${DB_SERVER};Port=${DB_PORT};Database=hxcoreblog;Uid=${DB_UID};Pwd=${DB_PWD};CharSet=utf8
      - ConnectionStrings__IdsConnectionString=Server=${DB_SERVER};Port=${DB_PORT};Database=hxidentityserver;Uid=${DB_UID};Pwd=${DB_PWD};CharSet=utf8
      - CorsAccessorSettings__WithOrigins=["http://192.168.233.128:8000/", "http://192.168.233.128","http://192.168.233.128:8000"]
      - Startup__ApiName=Hx.Core.Blog
    ports:
      - 5003:5003
    dns:
      - ${DNS_PROVIDER1}
      - ${DNS_PROVIDER2}

  hx.identityserver.api:
    container_name: hx.identityserver.api
    image: registry.cn-hangzhou.aliyuncs.com/songtaojie_centos/hx.identityserver.api
    build:
      context: /home/songtaojie/git/hx-identity-server
      dockerfile: src/Hx.IdentityServer/Dockerfile
    environment:
      - ConnectionStrings__DbType=mysql
      - ConnectionStrings__DefaultConnection=Server=${DB_SERVER};Port=${DB_PORT};Database=hxidentityserver;Uid=${DB_UID};Pwd=${DB_PWD};CharSet=utf8
    ports:
      - 5002:5002
    dns:
      - ${DNS_PROVIDER1}
      - ${DNS_PROVIDER2}
